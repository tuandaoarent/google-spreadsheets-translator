<!DOCTYPE html>
<html>

  <head>
    <base target="_top">
    <link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons1.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@7.3.2/css/flag-icons.min.css" />
  <style>
  body {
    font-family: 'Roboto', Arial, sans-serif;
    margin: 0;
    padding: 0;
    background-color: #2d5a3d;
    color: #333;
    height: 100vh;
    overflow-y: auto;
  }

  .main-content {
    background-color: #f5f5f5;
    margin: 8px;
    border-radius: 12px 12px 0 0;
    min-height: calc(100vh - 16px);
    padding: 20px 20px 50px 20px;
  }

  .section-title {
    color: #2d5a3d;
    font-size: 16px;
    font-weight: 600;
    margin: 0 0 8px 0;
    padding-bottom: 8px;
    border-bottom: 1px solid #2d5a3d;
  }

  .language-group {
    margin-bottom: 20px;
  }

  .language-label {
    display: block;
    font-size: 14px;
    color: #333;
    margin-bottom: 8px;
    font-weight: 500;
  }

  .language-select {
    position: relative;
    width: 100%;
  }

  .language-input {
    width: 100%;
    padding: 12px 16px;
    border: none;
    border-radius: 8px;
    background-color: #e8e8e8;
    font-size: 14px;
    color: #333;
    cursor: pointer;
    display: flex;
    align-items: center;
    box-sizing: border-box;
    position: relative;
    z-index: 1;
  }

  .language-input:focus {
    outline: none;
    background-color: #ddd;
  }

  .language-icon {
    width: 16px;
    height: 16px;
    margin-right: 8px;
    display: inline-block;
    font-size: 16px;
  }

  .language-text {
    flex: 1;
    text-align: left;
  }

  .dropdown-arrow {
    width: 16px;
    height: 16px;
    margin-left: auto;
    opacity: 0.6;
    font-size: 12px;
    transition: transform 0.3s ease;
  }

  .language-input.open .dropdown-arrow {
    transform: rotate(180deg);
  }

  .dropdown-menu {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: white;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    z-index: 1000;
    max-height: 200px;
    overflow-y: auto;
    display: none;
    margin-top: 2px;
  }

  .dropdown-menu.open {
    display: block;
  }

  .dropdown-item {
    padding: 12px 16px;
    cursor: pointer;
    display: flex;
    align-items: center;
    font-size: 14px;
    color: #333;
    border-bottom: 1px solid #f0f0f0;
    transition: background-color 0.2s ease;
  }

  .dropdown-item:last-child {
    border-bottom: none;
  }

  .dropdown-item:hover {
    background-color: #f8f9fa;
  }

  .dropdown-item.selected {
    background-color: #007bff;
    color: white;
  }

  .dropdown-item .language-icon {
    margin-right: 8px;
    font-size: 16px;
  }

  .dropdown-item .country-code {
    font-size: 12px;
    color: #666;
    width: 24px;
    text-align: center;
  }

  .dropdown-item.selected .country-code {
    color: rgba(255, 255, 255, 0.8);
  }

  .dropdown-item .language-icon {
    width: 20px;
    text-align: center;
  }

  .dropdown-item .language-name {
    flex: 1;
  }

  /* Custom scrollbar for dropdown */
  .dropdown-menu::-webkit-scrollbar {
    width: 6px;
  }

  .dropdown-menu::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 3px;
  }

  .dropdown-menu::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 3px;
  }

  .dropdown-menu::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
  }

  .translate-button {
    width: 100%;
    height: auto;
    background-color: #f5f5f5;
    color: #333;
    border: 1px solid #ddd;
    padding: 12px 16px;
    border-radius: 8px;
    font-size: 16px;
    font-weight: bold;
    text-transform: uppercase;
    text-align: center;
    cursor: pointer;
    margin-top: 20px;
    transition: background-color 0.3s ease;
    display: block;
    box-sizing: border-box;
    line-height: 1.2;
  }

  .translate-button:hover {
    background-color: #e9e9e9;
  }

  .translate-button:active {
    background-color: #ddd;
  }

  .translate-button:disabled {
    background-color: #f5f5f5;
    color: #999;
    cursor: not-allowed;
    opacity: 0.6;
  }

  .translate-button:disabled:hover {
    background-color: #f5f5f5;
  }

  .translate-button.translating {
    background-color: #f5f5f5;
    color: #999;
    cursor: not-allowed;
    opacity: 0.6;
  }

  .translate-button.translating:hover {
    background-color: #f5f5f5;
  }

  .advanced-settings {
    margin-top: 30px;
  }

  .advanced-title {
    display: flex;
    align-items: center;
    color: #2d5a3d;
    font-size: 16px;
    font-weight: 600;
    margin: 0 0 8px 0;
    padding-bottom: 8px;
    border-bottom: 1px solid #2d5a3d;
  }

  .gear-icon {
    width: 16px;
    height: 16px;
    margin-right: 8px;
    opacity: 0.7;
    display: inline-block;
    vertical-align: middle;
    line-height: 1;
  }

  .setting-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
    font-size: 14px;
    color: #333;
  }

  .setting-label {
    flex: 1;
    text-align: left;
  }

  .toggle-switch {
    position: relative;
    width: 44px;
    height: 24px;
    background-color: #ccc;
    border-radius: 12px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  .toggle-switch.active {
    background-color: #2d5a3d;
  }

  .toggle-slider {
    position: absolute;
    top: 2px;
    left: 2px;
    width: 20px;
    height: 20px;
    background-color: white;
    border-radius: 50%;
    transition: transform 0.3s ease;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
  }

  .toggle-switch.active .toggle-slider {
    transform: translateX(20px);
  }

  .footer {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background-color: #2d5a3d;
    padding: 12px 20px;
    text-align: center;
    font-size: 12px;
  }

  .footer-links {
    color: #90c695;
  }

  .footer-links a {
    color: #90c695;
    text-decoration: none;
    margin: 0 8px;
  }

  .footer-links a:hover {
    color: #a8d4ac;
  }

  .about-info {
    color: #666;
    font-size: 12px;
    margin-top: 20px;
    text-align: center;
    opacity: 0.7;
    padding: 12px;
    border-top: 1px solid #e0e0e0;
  }

  .status {
    text-align: center;
    padding: 10px;
    border-radius: 4px;
    margin-top: 10px;
    font-size: 12px;
    font-weight: 500;
    display: none;
    word-wrap: break-word;
  }

  .status.success {
    background-color: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
  }

  .status.error {
    background-color: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
  }

  /* Help Overlay Styles */
  .help-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
    box-sizing: border-box;
  }

  .help-content {
    background: white;
    border-radius: 12px;
    max-width: 600px;
    width: 100%;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    animation: helpSlideIn 0.3s ease-out;
  }

  @keyframes helpSlideIn {
    from {
      opacity: 0;
      transform: scale(0.9) translateY(-20px);
    }
    to {
      opacity: 1;
      transform: scale(1) translateY(0);
    }
  }

  .help-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 24px 16px 24px;
    border-bottom: 1px solid #e0e0e0;
    background-color: #f8f9fa;
    border-radius: 12px 12px 0 0;
  }

  .help-header h2 {
    margin: 0;
    color: #2d5a3d;
    font-size: 20px;
    font-weight: 600;
  }

  .help-close {
    background: none;
    border: none;
    outline: none;
    font-size: 20px;
    color: #666;
    cursor: pointer;
    padding: 0;
    width: 32px;
    height: 32px;
    min-width: 32px;
    min-height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: background-color 0.2s ease;
    box-shadow: none;
    flex-shrink: 0;
    line-height: 1;
  }

  .help-close:hover {
    background-color: #e9ecef;
    color: #333;
  }

  .help-body {
    padding: 24px;
    line-height: 1.6;
    color: #333;
  }

  .help-body h3 {
    color: #2d5a3d;
    font-size: 16px;
    font-weight: 600;
    margin: 20px 0 12px 0;
  }

  .help-body h3:first-child {
    margin-top: 0;
  }

  .help-body ol, .help-body ul {
    margin: 12px 0;
    padding-left: 20px;
  }

  .help-body li {
    margin-bottom: 8px;
  }

  .help-body strong {
    color: #2d5a3d;
    font-weight: 600;
  }

  /* Custom scrollbar for help content */
  .help-content::-webkit-scrollbar {
    width: 8px;
  }

  .help-content::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 4px;
  }

  .help-content::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 4px;
  }

  .help-content::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
  }
</style>
</head>

<body>
  <div class="main-content">
    <!-- Translation Section -->
    <h2 class="section-title">Translation</h2>

    <div class="language-group" id="sourceLanguageGroup">
      <label class="language-label">Source language</label>
      <div class="language-select">
        <div class="language-input" onclick="toggleSourceDropdown()">
          <span class="language-icon"></span>
          <span class="language-text"></span>
          <span class="dropdown-arrow">‚è∑</span>
        </div>
        <div class="dropdown-menu">
          <!-- Source language options will be populated by JavaScript -->
        </div>
      </div>
    </div>

    <div class="language-group" id="targetLanguageGroup">
      <label class="language-label">Target language</label>
      <div class="language-select">
        <div class="language-input" onclick="toggleTargetDropdown()">
          <span class="language-icon"></span>
          <span class="language-text"></span>
          <span class="dropdown-arrow">‚è∑</span>
        </div>
        <div class="dropdown-menu">
          <!-- Target language options will be populated by JavaScript -->
        </div>
      </div>
    </div>
    
    <!-- HTML Template for dropdown items -->
    <template id="dropdownItemTemplate">
      <div class="dropdown-item" data-code="">
        <span class="language-icon fi"></span>
        <div class="country-code"></div>
        <span class="language-name"></span>
      </div>
    </template>

    <button class="translate-button" onclick="translateContent()">TRANSLATE</button>

    <div id="status" class="status"></div>

    <!-- Advanced Settings Section -->
    <div class="advanced-settings">
      <h2 class="advanced-title">
        <span class="gear-icon">‚öôÔ∏è</span>
        Advanced settings
      </h2>

      <div class="setting-item">
        <span class="setting-label">Translate full sheet</span>
        <div class="toggle-switch" id="fullSheetToggle" onclick="toggleSetting('fullSheet')">
          <div class="toggle-slider"></div>
        </div>
      </div>

      <div class="setting-item">
        <span class="setting-label">Duplicate sheet before to translate</span>
        <div class="toggle-switch active" id="duplicateSheetToggle" onclick="toggleSetting('duplicateSheet')">
          <div class="toggle-slider"></div>
        </div>
      </div>

      <div class="setting-item">
        <span class="setting-label">Apply background color to edited cells</span>
        <div class="toggle-switch active" id="backgroundColorToggle" onclick="toggleSetting('backgroundColor')">
          <div class="toggle-slider"></div>
        </div>
      </div>
    </div>
    
    <!-- About Information -->
    <div class="about-info">
      Google Sheets Translation Extension v1.0 - Translate your spreadsheet content easily!
    </div>
    </div>
    
  <!-- Help Overlay -->
  <div id="helpOverlay" class="help-overlay" style="display: none;">
    <div class="help-content">
      <div class="help-header">
        <h2>Help & Instructions</h2>
        <button class="help-close" onclick="closeHelp()">&times;</button>
      </div>
      <div class="help-body">
        <h3>How to Use the Translation Extension:</h3>
        <ol>
          <li><strong>Select Source Language:</strong> Choose the language of your current content, or use "Auto detect" to automatically identify the language.</li>
          <li><strong>Select Target Language:</strong> Choose the language you want to translate to.</li>
          <li><strong>Click TRANSLATE:</strong> The extension will translate your selected content.</li>
        </ol>
        
        <h3>Advanced Settings:</h3>
        <ul>
          <li><strong>Translate full sheet:</strong> Translate the entire spreadsheet instead of just selected cells.</li>
          <li><strong>Duplicate sheet before translate:</strong> Create a copy of your sheet before translating to preserve the original.</li>
          <li><strong>Apply background color to edited cells:</strong> Highlight translated cells with a background color for easy identification.</li>
        </ul>
        
        <h3>Tips:</h3>
        <ul>
          <li>Make sure you have selected the cells you want to translate before clicking TRANSLATE.</li>
          <li>Use "Auto detect" for source language when you're unsure of the original language.</li>
          <li>Enable "Duplicate sheet" to keep your original data safe.</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="footer">
    <div class="footer-links">
      <a href="#" onclick="showHelp()">Need help?</a>
    </div>
  </div>

  <script>
  // Translation settings
  let settings = {
    fullSheet: false,
    duplicateSheet: true,
    backgroundColor: true
  };

  // Language options - comprehensive list matching the image
  const languages = [
    { countryCode: 'auto', languageCode: 'auto', name: 'Auto detect', codeDisplay: '' },
    { countryCode: 'us', languageCode: 'en', name: 'English', codeDisplay: 'üá∫üá∏' },
    { countryCode: 'fr', languageCode: 'fr', name: 'French', codeDisplay: 'üá´üá∑' },
    { countryCode: 'de', languageCode: 'de', name: 'German', codeDisplay: 'üá©üá™' },
    { countryCode: 'it', languageCode: 'it', name: 'Italian', codeDisplay: 'üáÆüáπ' },
    { countryCode: 'es', languageCode: 'es', name: 'Spanish', codeDisplay: 'üá™üá∏' },
    { countryCode: 'za', languageCode: 'af', name: 'Afrikaans', codeDisplay: '' },
    { countryCode: 'al', languageCode: 'sq', name: 'Albanian', codeDisplay: 'üá¶üá±' },
    { countryCode: 'sa', languageCode: 'ar', name: 'Arabic', codeDisplay: 'üá∏üá¶' },
    { countryCode: 'az', languageCode: 'az', name: 'Azerbaijani', codeDisplay: 'üá¶üáø' },
    { countryCode: 'es', languageCode: 'eu', name: 'Basque', codeDisplay: '' },
    { countryCode: 'bd', languageCode: 'bn', name: 'Bengali', codeDisplay: '' },
    { countryCode: 'by', languageCode: 'be', name: 'Belarusian', codeDisplay: 'üáßüáæ' },
    { countryCode: 'bg', languageCode: 'bg', name: 'Bulgarian', codeDisplay: 'üáßüá¨' },
    { countryCode: 'mm', languageCode: 'my', name: 'Burmese', codeDisplay: 'üá≤üá≤' },
    { countryCode: 'es', languageCode: 'ca', name: 'Catalan', codeDisplay: '' },
    { countryCode: 'cn', languageCode: 'zh', name: 'Chinese (Simplified)', codeDisplay: 'üá®üá≥' },
    { countryCode: 'tw', languageCode: 'zh-tw', name: 'Chinese (Traditional)', codeDisplay: 'üáπüáº' },
    { countryCode: 'hr', languageCode: 'hr', name: 'Croatian', codeDisplay: 'üá≠üá∑' },
    { countryCode: 'cz', languageCode: 'cs', name: 'Czech', codeDisplay: 'üá®üáø' },
    { countryCode: 'dk', languageCode: 'da', name: 'Danish', codeDisplay: 'üá©üá∞' },
    { countryCode: 'nl', languageCode: 'nl', name: 'Dutch', codeDisplay: 'üá≥üá±' },
    { countryCode: 'ee', languageCode: 'et', name: 'Estonian', codeDisplay: 'üá™üá™' },
    { countryCode: 'fi', languageCode: 'fi', name: 'Finnish', codeDisplay: 'üá´üáÆ' },
    { countryCode: 'gr', languageCode: 'el', name: 'Greek', codeDisplay: 'üá¨üá∑' },
    { countryCode: 'il', languageCode: 'he', name: 'Hebrew', codeDisplay: 'üáÆüá±' },
    { countryCode: 'in', languageCode: 'hi', name: 'Hindi', codeDisplay: 'üáÆüá≥' },
    { countryCode: 'hu', languageCode: 'hu', name: 'Hungarian', codeDisplay: 'üá≠üá∫' },
    { countryCode: 'is', languageCode: 'is', name: 'Icelandic', codeDisplay: 'üáÆüá∏' },
    { countryCode: 'id', languageCode: 'id', name: 'Indonesian', codeDisplay: 'üáÆüá©' },
    { countryCode: 'ie', languageCode: 'ga', name: 'Irish', codeDisplay: 'üáÆüá™' },
    { countryCode: 'jp', languageCode: 'ja', name: 'Japanese', codeDisplay: 'üáØüáµ' },
    { countryCode: 'kr', languageCode: 'ko', name: 'Korean', codeDisplay: 'üá∞üá∑' },
    { countryCode: 'lv', languageCode: 'lv', name: 'Latvian', codeDisplay: 'üá±üáª' },
    { countryCode: 'lt', languageCode: 'lt', name: 'Lithuanian', codeDisplay: 'üá±üáπ' },
    { countryCode: 'mk', languageCode: 'mk', name: 'Macedonian', codeDisplay: 'üá≤üá∞' },
    { countryCode: 'my', languageCode: 'ms', name: 'Malay', codeDisplay: 'üá≤üáæ' },
    { countryCode: 'mt', languageCode: 'mt', name: 'Maltese', codeDisplay: 'üá≤üáπ' },
    { countryCode: 'no', languageCode: 'no', name: 'Norwegian', codeDisplay: 'üá≥üá¥' },
    { countryCode: 'ir', languageCode: 'fa', name: 'Persian', codeDisplay: 'üáÆüá∑' },
    { countryCode: 'pl', languageCode: 'pl', name: 'Polish', codeDisplay: 'üáµüá±' },
    { countryCode: 'pt', languageCode: 'pt', name: 'Portuguese', codeDisplay: 'üáµüáπ' },
    { countryCode: 'ro', languageCode: 'ro', name: 'Romanian', codeDisplay: 'üá∑üá¥' },
    { countryCode: 'ru', languageCode: 'ru', name: 'Russian', codeDisplay: 'üá∑üá∫' },
    { countryCode: 'rs', languageCode: 'sr', name: 'Serbian', codeDisplay: 'üá∑üá∏' },
    { countryCode: 'sk', languageCode: 'sk', name: 'Slovak', codeDisplay: 'üá∏üá∞' },
    { countryCode: 'si', languageCode: 'sl', name: 'Slovenian', codeDisplay: 'üá∏üáÆ' },
    { countryCode: 'tz', languageCode: 'sw', name: 'Swahili', codeDisplay: 'üáπüáø' },
    { countryCode: 'se', languageCode: 'sv', name: 'Swedish', codeDisplay: 'üá∏üá™' },
    { countryCode: 'th', languageCode: 'th', name: 'Thai', codeDisplay: 'üáπüá≠' },
    { countryCode: 'tr', languageCode: 'tr', name: 'Turkish', codeDisplay: 'üáπüá∑' },
    { countryCode: 'ua', languageCode: 'uk', name: 'Ukrainian', codeDisplay: 'üá∫üá¶' },
    { countryCode: 'pk', languageCode: 'ur', name: 'Urdu', codeDisplay: 'üáµüá∞' },
    { countryCode: 'vn', languageCode: 'vi', name: 'Vietnamese', codeDisplay: 'üáªüá≥' },
    { countryCode: 'gb', languageCode: 'cy', name: 'Welsh', codeDisplay: 'üá¨üáß' }
  ];

  let selectedSourceLanguage = 'auto';
  let selectedTargetLanguage = 'en';
  let sourceDropdownOpen = false;
  let targetDropdownOpen = false;
  let statusTimeout = null;

  // Load initial data when sidebar opens
  document.addEventListener('DOMContentLoaded', function () {
    initializeUI();
  });

  /**
   * Initialize the UI
   */
  function initializeUI() {
    // Set default languages
    selectedSourceLanguage = 'auto';
    selectedTargetLanguage = 'en';

    populateDropdowns();
    updateLanguageDisplay();
    updateToggleStates();
    setupClickOutside();
    setupHelpOverlay();
  }

  /**
   * Populate dropdown menus with language options
   */
  function populateDropdowns() {
    const sourceDropdown = document.querySelector('#sourceLanguageGroup .dropdown-menu');
    const targetDropdown = document.querySelector('#targetLanguageGroup .dropdown-menu');

    // Populate source dropdown (includes auto detect)
    sourceDropdown.innerHTML = '';
    languages.forEach(lang => {
      const item = createDropdownItem(lang, 'source');
      sourceDropdown.appendChild(item);
    });

    // Populate target dropdown (excludes auto detect)
    targetDropdown.innerHTML = '';
    languages.filter(lang => lang.languageCode !== 'auto').forEach(lang => {
      const item = createDropdownItem(lang, 'target');
      targetDropdown.appendChild(item);
    });
  }

  /**
   * Create a dropdown item element using HTML template
   * @param {Object} lang - Language object
   * @param {string} type - 'source' or 'target'
   */
  function createDropdownItem(lang, type) {
    const template = document.getElementById('dropdownItemTemplate');
    const item = template.content.cloneNode(true);
    const dropdownItem = item.querySelector('.dropdown-item');

    // Set data attributes and classes
    dropdownItem.setAttribute('data-code', lang.countryCode);

    if ((type === 'source' && lang.languageCode === selectedSourceLanguage) ||
      (type === 'target' && lang.languageCode === selectedTargetLanguage)) {
      dropdownItem.classList.add('selected');
    }

    // Populate template content
    const countryCode = dropdownItem.querySelector('.country-code');
    const languageIcon = dropdownItem.querySelector('.language-icon');
    const languageName = dropdownItem.querySelector('.language-name');

    // Special case for Auto Detect - hide country code
    if (lang.languageCode === 'auto') {
      countryCode.style.display = 'none';
    } else {
      countryCode.textContent = lang.codeDisplay;
      countryCode.style.display = 'inline';
    }

    // languageIcon.textContent = lang.icon;
    updateFlagClass(languageIcon, lang.countryCode);
    languageName.textContent = lang.name;

    // Add click event
    dropdownItem.onclick = () => selectLanguage(lang.languageCode, type);

    return item;
  }

  /**
   * Toggle source language dropdown
   */
  function toggleSourceDropdown() {
    if (targetDropdownOpen) {
      closeTargetDropdown();
    }
    sourceDropdownOpen = !sourceDropdownOpen;
    const dropdown = document.querySelector('#sourceLanguageGroup .dropdown-menu');
    const input = document.querySelector('#sourceLanguageGroup .language-input');

    if (sourceDropdownOpen) {
      dropdown.classList.add('open');
      input.classList.add('open');
    } else {
      dropdown.classList.remove('open');
      input.classList.remove('open');
    }
  }

  /**
   * Toggle target language dropdown
   */
  function toggleTargetDropdown() {
    if (sourceDropdownOpen) {
      closeSourceDropdown();
    }
    targetDropdownOpen = !targetDropdownOpen;
    const dropdown = document.querySelector('#targetLanguageGroup .dropdown-menu');
    const input = document.querySelector('#targetLanguageGroup .language-input');

    if (targetDropdownOpen) {
      dropdown.classList.add('open');
      input.classList.add('open');
    } else {
      dropdown.classList.remove('open');
      input.classList.remove('open');
    }
  }

  /**
   * Close source dropdown
   */
  function closeSourceDropdown() {
    sourceDropdownOpen = false;
    const dropdown = document.querySelector('#sourceLanguageGroup .dropdown-menu');
    const input = document.querySelector('#sourceLanguageGroup .language-input');
    dropdown.classList.remove('open');
    input.classList.remove('open');
  }

  /**
   * Close target dropdown
   */
  function closeTargetDropdown() {
    targetDropdownOpen = false;
    const dropdown = document.querySelector('#targetLanguageGroup .dropdown-menu');
    const input = document.querySelector('#targetLanguageGroup .language-input');
    dropdown.classList.remove('open');
    input.classList.remove('open');
  }

  /**
   * Select a language
   * @param {string} code - Language code
   * @param {string} type - 'source' or 'target'
   */
  function selectLanguage(code, type) {
    if (type === 'source') {
      selectedSourceLanguage = code;
      closeSourceDropdown();
      updateLanguageDisplay('source');
    } else {
      selectedTargetLanguage = code;
      closeTargetDropdown();
      updateLanguageDisplay('target');
    }

    populateDropdowns(); // Refresh to update selected states
  }

  /**
   * Update flag class for a language icon element
   * @param {HTMLElement} iconElement - The icon element to update
   * @param {string} countryCode - The country code for the flag class
   */
  function updateFlagClass(iconElement, countryCode) {
    // Remove existing flag classes
    iconElement.className = iconElement.className.replace(/fi-\w+/g, '');

    // Special case for Auto Detect - show globe icon
    if (countryCode === 'auto') {
      iconElement.classList.remove('fi');
      iconElement.textContent = 'üåê';
    } else {
      iconElement.textContent = '';
      // Add new flag class
      iconElement.classList.add('fi');
      iconElement.classList.add('fi-' + countryCode);
    }
  }

  /**
   * Update language display
   * @param {string} type - 'source', 'target', or undefined for both
   */
  function updateLanguageDisplay(type) {
    if (type === 'source' || type === undefined) {
      const sourceLang = languages.find(lang => lang.languageCode === selectedSourceLanguage);
      document.querySelector('#sourceLanguageGroup .language-text').textContent = sourceLang.name;

      // Update source icon
      const sourceIcon = document.querySelector('#sourceLanguageGroup .language-icon');
      updateFlagClass(sourceIcon, sourceLang.countryCode);
    }

    if (type === 'target' || type === undefined) {
      const targetLang = languages.find(lang => lang.languageCode === selectedTargetLanguage);
      document.querySelector('#targetLanguageGroup .language-text').textContent = targetLang.name;

      // Update target icon
      const targetIcon = document.querySelector('#targetLanguageGroup .language-icon');
      updateFlagClass(targetIcon, targetLang.countryCode);
    }
  }

  /**
   * Setup click outside to close dropdowns
   */
  function setupClickOutside() {
    document.addEventListener('click', function (event) {
      const sourceSelect = document.querySelector('#sourceLanguageGroup .language-select');
      const targetSelect = document.querySelector('#targetLanguageGroup .language-select');

      if (!sourceSelect.contains(event.target) && sourceDropdownOpen) {
        closeSourceDropdown();
      }

      if (!targetSelect.contains(event.target) && targetDropdownOpen) {
        closeTargetDropdown();
      }
    });
  }

  /**
   * Toggle a setting
   * @param {string} settingName - The name of the setting to toggle
   */
  function toggleSetting(settingName) {
    settings[settingName] = !settings[settingName];
    updateToggleStates();
  }

  /**
   * Update toggle switch states
   */
  function updateToggleStates() {
    Object.keys(settings).forEach(setting => {
      const toggle = document.getElementById(setting + 'Toggle');
      if (settings[setting]) {
        toggle.classList.add('active');
      } else {
        toggle.classList.remove('active');
      }
    });
  }

  /**
   * Translate content
   */
  function translateContent() {
    // Disable the translate button
    const translateButton = document.querySelector('.translate-button');
    translateButton.disabled = true;
    translateButton.textContent = 'TRANSLATING...';
    translateButton.classList.add('translating');

    showStatus('Translating...', 'success');

    try {
      if (typeof google !== 'undefined' && google.script && google.script.run) {
        // Convert country codes to language codes
        // selectedSourceLanguage and selectedTargetLanguage are already language codes
        const sourceLang = selectedSourceLanguage;
        const targetLang = selectedTargetLanguage;
        
        google.script.run
          .withSuccessHandler(function (result) {
            if (result.success) {
              showStatus(result.message, 'success');
            } else {
              showStatus(result.message, 'error');
            }
          })
          .withFailureHandler(function(error) {
            showError(error);
          })
          .translateCurrentCell(sourceLang, targetLang);
      } else {
        // Fallback for local development or when Google Apps Script is not available
        showStatus('Google Apps Script environment not available. This is a demo mode.', 'error');
      }
    } catch (error) {
      showError(error);
    } finally {
      enableTranslateButton();
    }
  }

  /**
   * Enable the translate button
   */
  function enableTranslateButton() {
    const translateButton = document.querySelector('.translate-button');
    translateButton.disabled = false;
    translateButton.textContent = 'TRANSLATE';
    translateButton.classList.remove('translating');
  }

  /**
   * Show help overlay
   */
  function showHelp() {
    const overlay = document.getElementById('helpOverlay');
    overlay.style.display = 'flex';
    document.body.style.overflow = 'hidden'; // Prevent background scrolling
  }

  /**
   * Close help overlay
   */
  function closeHelp() {
    const overlay = document.getElementById('helpOverlay');
    overlay.style.display = 'none';
    document.body.style.overflow = 'auto'; // Restore scrolling
  }

  /**
   * Setup help overlay event listeners
   */
  function setupHelpOverlay() {
    const overlay = document.getElementById('helpOverlay');
    
    // Close on overlay background click
    overlay.addEventListener('click', function(e) {
      if (e.target === overlay) {
        closeHelp();
      }
    });
    
    // Close on escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && overlay.style.display === 'flex') {
        closeHelp();
      }
    });
  }


  /**
   * Shows a status message
   * @param {string} message - The message to show
   * @param {string} type - The type of message (success or error)
   */
  function showStatus(message, type) {
    const statusDiv = document.getElementById('status');
    statusDiv.textContent = message;
    statusDiv.className = 'status ' + type;
    statusDiv.style.display = 'block';

    // Clear any existing timeout
    if (statusTimeout) {
      clearTimeout(statusTimeout);
    }

    // Hide status after 4 seconds
    statusTimeout = setTimeout(function () {
      statusDiv.style.display = 'none';
      statusTimeout = null;
    }, 4000);
  }

  /**
   * Shows an error message
   * @param {Error} error - The error object
   */
  function showError(error) {
    console.error('Error:', error);
    showStatus('An error occurred: ' + error.message, 'error');
  }
</script>

  <script>
    </script>
  </body>

</html>